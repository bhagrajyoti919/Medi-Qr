<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="gemini-api-key" content="AIzaSyDgsAmMOtosi2N2SlfvfOOGxFw8aCL8te4">
    <title>Mobile App UI</title>
    <script>
      (function(){
        try {
          var fromSlide = sessionStorage.getItem('fromSlide') === 'true';
          if (!fromSlide) {
            window.location.replace('slide.html');
            return;
          }
          // Allow index once per session after coming from slide
          sessionStorage.removeItem('fromSlide');
        } catch(e) {
          window.location.replace('slide.html');
        }
      })();
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="navigation.css">
</head>
<body>
    <div class="app-container">
        <!-- Navigation Menu -->
        <div class="nav-container">
            <button class="hamburger-btn" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <!-- Overlay Menu -->
        <div class="overlay-menu" id="overlayMenu">
            <button class="close-btn" id="closeBtn">&times;</button>
            
            <!-- User Profile Header -->
            <div class="user-header">
                <h3 id="navPatientName">patient name</h3>
                <div class="profile-pic" onclick="openEditProfile()">
                    <img id="navProfilePic" alt="User Photo">
                </div>
            </div>
            
            <nav class="nav-menu">
                <ul>
                    <li><a href="#" onclick="openUserInfo()">user information</a></li>
                    <li><a href="#" onclick="openDoctorInfo()">doctor information</a></li>
                    <li><a href="#" onclick="openPatientHistory()">Patient History</a></li>
                </ul>
            </nav>
        </div>

        <div class="content-area" id="contentArea">
            <!-- Card will load here by default -->
        </div>
        <div class="bottom-tabs">
            <button class="tab active" id="cardBtn" onclick="showCard()">card</button>
            <button class="tab" id="profileBtn" onclick="showProfile()">reports</button>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content edit-profile-modal">
            <span class="modal-close" onclick="closeModal('editProfileModal')">&times;</span>
            <h2>Edit Profile</h2>
            <div class="modal-body">
                <!-- Profile Photo Section -->
                <div class="edit-photo-section">
                    <div class="edit-profile-pic">
                        <img id="editProfilePic" alt="Profile Photo">
                        <label for="photoUpload" class="photo-upload-btn">
                            <span>üì∑</span>
                        </label>
                        <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                    </div>
                    
                </div>

                <!-- Editable Form -->
                <form id="profileForm" class="profile-form">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="fullName" placeholder="Enter full name" required>
                    </div>

                    <div class="form-group">
                        <label>Patient ID</label>
                        <input type="text" id="patientId" placeholder="Enter patient ID" required>
                    </div>

                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" id="age" placeholder="Enter age" required>
                    </div>

                    <div class="form-group">
                        <label>Gender</label>
                        <select id="gender" required>
                            <option value="">Select gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Blood Group</label>
                        <select id="bloodGroup" required>
                            <option value="">Select blood group</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="Enter email" required>
                    </div>

                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="phone" placeholder="Enter phone number" required>
                    </div>

                    <div class="form-group">
                        <label>Address</label>
                        <textarea id="address" placeholder="Enter address" rows="3" required></textarea>
                    </div>

                    <div class="form-group">
                        <label>Emergency Contact</label>
                        <input type="tel" id="emergencyContact" placeholder="Enter emergency contact" required>
                    </div>

                    <div class="form-group">
                        <label>Medical Conditions</label>
                        <textarea id="medicalConditions" placeholder="Enter any medical conditions" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Allergies</label>
                        <textarea id="allergies" placeholder="Enter any allergies" rows="2"></textarea>
                    </div>

                    <button type="submit" class="save-btn">Save Profile</button>
                </form>
            </div>
        </div>
    </div>

        <!-- User Information Modal -->
    <div class="modal" id="userInfoModal">
        <div class="modal-content">
            <button class="edit-icon-btn" onclick="toggleEditMode('userInfo')" title="Edit">
                <span id="userInfoEditIcon">‚úèÔ∏è</span>
            </button>
            <span class="modal-close" onclick="closeModal('userInfoModal')">&times;</span>
            <h2>User Information</h2>
            <div class="modal-body">
                <!-- View Mode -->
                <div id="userInfoView">
                    <!-- Content will be loaded dynamically -->
                </div>
                
                <!-- Edit Mode -->
                <form id="userInfoEditForm" class="edit-form" style="display: none;">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="editUserName" required>
                    </div>
                    <div class="form-group">
                        <label>Patient ID</label>
                        <input type="text" id="editUserPatientId" required>
                    </div>
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" id="editUserAge" required>
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="editUserGender" required>
                            <option value="">Select gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Blood Group</label>
                        <select id="editUserBloodGroup" required>
                            <option value="">Select blood group</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="editUserEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="editUserPhone" required>
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <textarea id="editUserAddress" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="save-btn">Save Changes</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Doctor Information Modal -->
    <div class="modal" id="doctorInfoModal">
        <div class="modal-content">
            <button class="edit-icon-btn" onclick="toggleEditMode('doctorInfo')" title="Edit">
                <span id="doctorInfoEditIcon">‚úèÔ∏è</span>
            </button>
            <span class="modal-close" onclick="closeModal('doctorInfoModal')">&times;</span>
            <h2>Doctor Information</h2>
            <div class="modal-body">
                <!-- View Mode -->
                <div id="doctorInfoView">
                    <p><strong>Name:</strong> <span id="doctorName">Dr. Sarah Smith</span></p>
                    <p><strong>Specialization:</strong> <span id="doctorSpec">Cardiologist</span></p>
                    <p><strong>Experience:</strong> <span id="doctorExp">15 years</span></p>
                    <p><strong>Clinic:</strong> <span id="doctorClinic">City Medical Center</span></p>
                    <p><strong>Phone:</strong> <span id="doctorPhone">+91 9123456789</span></p>
                    <p><strong>Available:</strong> <span id="doctorAvail">Mon-Fri, 9 AM - 5 PM</span></p>
                </div>
                
                <!-- Edit Mode -->
                <form id="doctorInfoEditForm" class="edit-form" style="display: none;">
                    <div class="form-group">
                        <label>Doctor Name</label>
                        <input type="text" id="editDoctorName" required>
                    </div>
                    <div class="form-group">
                        <label>Specialization</label>
                        <input type="text" id="editDoctorSpec" required>
                    </div>
                    <div class="form-group">
                        <label>Experience</label>
                        <input type="text" id="editDoctorExp" required>
                    </div>
                    <div class="form-group">
                        <label>Clinic Name</label>
                        <input type="text" id="editDoctorClinic" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="editDoctorPhone" required>
                    </div>
                    <div class="form-group">
                        <label>Availability</label>
                        <input type="text" id="editDoctorAvail" required>
                    </div>
                    <button type="submit" class="save-btn">Save Changes</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Patient History Modal -->
    <div class="modal" id="patientHistoryModal">
        <div class="modal-content">
            <button class="edit-icon-btn" onclick="toggleEditMode('patientHistory')" title="Edit">
                <span id="patientHistoryEditIcon">‚úèÔ∏è</span>
            </button>
            <span class="modal-close" onclick="closeModal('patientHistoryModal')">&times;</span>
            <h2>Patient History</h2>
            <div class="modal-body">
                <!-- View Mode -->
                <div id="patientHistoryView">
                    <!-- Content will be loaded dynamically -->
                </div>
                
                <!-- Edit Mode -->
                <div id="patientHistoryEdit" style="display: none;">
                    <button class="add-history-btn" onclick="addNewHistoryEntry()">+ Add New Entry</button>
                    <div id="historyEntriesEdit">
                        <!-- Editable history entries will be loaded here -->
                    </div>
                    <button class="save-btn" onclick="savePatientHistory()">Save All Changes</button>
                </div>
            </div>
        </div>
    </div>


    <script src="navigation.js"></script>
    <script src="profile.js"></script>
    <script>
        // Load card on page load only after setup is done
        window.addEventListener('DOMContentLoaded', function() {
            try {
                if (localStorage.getItem('setupDone') !== 'true') return;
            } catch(e) { return; }
            loadUserProfile();
            showCard();
        });

        function showCard() {
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="card-container">
                    <div class="card" id="creditCard" onclick="flipCard()">
                        <div class="card-inner" id="cardInner">
                            <div class="front">
                                <img src="https://i.ibb.co/PYss3yv/map.png" class="map-img">
                                <div class="row">
                                    <img src="https://i.ibb.co/G9pDnYJ/chip.png" width="50px">
                                    <img src="https://i.ibb.co/WHZ3nRJ/visa.png" width="50px">
                                </div>
                                <div class="row card-no">
                                    <p>5244</p>
                                    <p>2150</p>
                                    <p>8252</p>
                                    <p>6420</p>
                                </div>
                                <div class="row card-holder">
                                    <p>CARD HOLDER</p>
                                    <p>VALID TILL</p>
                                </div>
                                <div class="row name">
                                    <p>JOE ALISON</p>
                                    <p>10 / 25</p>
                                </div>
                            </div>
                            <div class="back">
                                <img src="https://i.ibb.co/PYss3yv/map.png" class="map-img">
                                <div class="bar"></div>
                                <div class="row card-cvv">
                                    <div>
                                        <img src="https://i.ibb.co/S6JG8px/pattern.png">
                                    </div>
                                    <p>824</p>
                                </div>
                                <div class="row card-text">
                                    <p>This is a virtual card design using HTML and CSS. You can also design something like this.</p>
                                </div>
                                <div class="row signature">
                                    <p>CUSTOMER SIGNATURE</p>
                                    <img src="https://i.ibb.co/WHZ3nRJ/visa.png" width="60px">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('cardBtn').classList.add('active');
            document.getElementById('profileBtn').classList.remove('active');
        }

        function flipCard() {
            const cardInner = document.getElementById('cardInner');
            cardInner.classList.toggle('flipped');
        }

        function showProfile() {
            const contentArea = document.querySelector('.content-area');
            contentArea.innerHTML = `
                <div class="reports-container" id="reportsContainer">
                    <div class="reports-gallery" id="reportsGallery"></div>
                    <button class="ai-action-btn" id="aiActionBtn" onclick="openAiAssistant()">AI</button>
                    <button class="photo-action-btn" id="photoActionBtn" onclick="showPhotoOptions()"><span>+</span></button>
                </div>

                <div class="photo-options-modal" id="photoOptionsModal">
                    <div class="photo-options-content">
                        <button class="photo-option-btn" onclick="openCamera()">
                            <span class="option-icon">üì∑</span>
                            <span class="option-text">Take Photo</span>
                        </button>
                        <button class="photo-option-btn" onclick="openGallery()">
                            <span class="option-icon">üñºÔ∏è</span>
                            <span class="option-text">Choose from Gallery</span>
                        </button>
                        <button class="photo-option-btn cancel" onclick="closePhotoOptions()">
                            <span class="option-text">Cancel</span>
                        </button>
                    </div>
                </div>

                <!-- Camera input - opens device camera -->
                <input type="file" id="cameraInput" accept="image/*" capture="user" style="display: none;">
                <!-- Gallery input - opens photo gallery -->
                <input type="file" id="galleryInput" accept="image/*" multiple style="display: none;">

                <!-- Image Preview Modal -->
                <div class="image-preview-modal" id="imagePreviewModal" aria-hidden="true">
                    <div class="image-preview-content">
                        <button class="image-preview-close" onclick="closeImagePreview()" aria-label="Close preview">&times;</button>
                        <div class="image-preview-body">
                            <button class="preview-nav prev" onclick="prevPreviewImage()" aria-label="Previous">‚óÄ</button>
                            <img id="previewUploadedImage" class="image-preview-img" alt="Uploaded image preview" />
                            <button class="preview-nav next" onclick="nextPreviewImage()" aria-label="Next">‚ñ∂</button>
                            <div class="preview-actions">
                                <button class="add-more-btn" onclick="addMoreFromPreview()" aria-label="Add more">+ add more</button>
                                <button class="done-btn" onclick="donePreview()" aria-label="Done">Done</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            setTimeout(() => {
                try {
                    if (typeof renderReportsGallery === 'function') renderReportsGallery();
                    if (typeof setupPhotoInputs === 'function') setupPhotoInputs();
                    if (typeof setupIdleActionButtons === 'function') setupIdleActionButtons();
                } catch (e) { console.warn(e); }
            }, 100);
        }

    </script>
</body>
</html>
